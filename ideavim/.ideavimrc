" =============================================================================
" IDEAVIM CONFIGURATION FILE
" =============================================================================
" Author: Your Name
" Version: 2.0
" Last Modified: 2025-01-01
" Repository: https://github.com/yourusername/dotfiles
" =============================================================================

" =============================================================================
" TABLE OF CONTENTS
" =============================================================================
" 1.  CORE SETTINGS ................. Basic Vim behavior
" 2.  PLUGINS ....................... IdeaVim plugin extensions
" 3.  LEADER KEY .................... Leader key configuration
" 4.  WHICH-KEY ..................... Which-key descriptions
" 5.  KEY MAPPINGS .................. All keybindings
"     5.1  Navigation ............... Window/buffer navigation
"     5.2  File Operations ......... File search and exploration
"     5.3  Code Navigation ......... Go to definition, etc.
"     5.4  Code Actions ............ Refactoring and formatting
"     5.5  Git Operations .......... Version control
"     5.6  Run & Debug ............. Execution and debugging
"     5.7  Bookmarks ............... Bookmark management
"     5.8  Tool Windows ............ IDE panels
" 6.  VISUAL MODE ................... Visual mode specific
" 7.  UTILITIES ..................... Helper functions and settings
" =============================================================================

" =============================================================================
" 1. CORE SETTINGS
" =============================================================================

" -----------------------------------------------------------------------------
" Display Settings
" -----------------------------------------------------------------------------
set number                      " Show line numbers
set relativenumber             " Relative line numbers for easier jumps
set scrolloff=999              " Keep cursor centered vertically
set showmode                   " Display current mode in status bar

" -----------------------------------------------------------------------------
" Search Behavior
" -----------------------------------------------------------------------------
set ignorecase                 " Case-insensitive search...
set smartcase                  " ...unless query contains uppercase
set incsearch                  " Incremental search highlighting
set hlsearch                   " Highlight all search matches
set gdefault                   " Global substitutions by default (/g flag)

" -----------------------------------------------------------------------------
" Clipboard Integration
" -----------------------------------------------------------------------------
set clipboard+=unnamed         " Use system clipboard
set clipboard+=ideaput         " IntelliJ clipboard integration

" -----------------------------------------------------------------------------
" Editor Behavior
" -----------------------------------------------------------------------------
set visualbell                 " Visual feedback instead of beeping
set ideajoin                   " Smart line joining with J
set idearefactormode=keep      " Stay in Vim mode during refactoring
set ideamarks                  " Sync marks with IntelliJ bookmarks
set ideavimsupport=dialog      " Use IdeaVim in dialogs

" =============================================================================
" 2. PLUGINS
" =============================================================================
" Plugins extend IdeaVim with additional Vim features
" -----------------------------------------------------------------------------

" Text Manipulation
Plug 'surround'                " Surround text objects (ys, cs, ds)
Plug 'commentary'              " Comment with gc motion
Plug 'ReplaceWithRegister'     " Replace motion with register (gr)
Plug 'exchange'                " Exchange text regions (cx)

" Text Objects
Plug 'argtextobj'              " Function arguments (aa, ia)
Plug 'textobj-entire'          " Entire buffer (ae, ie)
Plug 'textobj-indent'          " Indentation levels (ai, ii, aI, iI)

" Navigation & Motion
Plug 'sneak'                   " 2-char search jump (s, S)
Plug 'quickscope'              " Highlight f/F/t/T targets
Plug 'vim-paragraph-motion'     " Better paragraph jumps
Plug 'matchit'                 " Extended % matching

" UI Enhancements
Plug 'NERDTree'                " File explorer sidebar
Plug 'highlightedyank'         " Visual feedback on yank
Plug 'multiple-cursors'        " Multi-cursor editing
Plug 'which-key'               " Keybinding popup help

" =============================================================================
" 3. LEADER KEY
" =============================================================================

let mapleader = " "            " Space as leader - ergonomic and accessible

" =============================================================================
" 4. WHICH-KEY DESCRIPTIONS
" =============================================================================
" Descriptions for which-key popup menu
" Shows when pressing <leader> and waiting
" -----------------------------------------------------------------------------

set which-key
set notimeout
set timeoutlen=1000

" -----------------------------------------------------------------------------
" Top Level
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_leader = "<leader> Leader"
let g:WhichKeyDesc_save = "<leader>w Save"
let g:WhichKeyDesc_comment = "<leader>/ Comment"
let g:WhichKeyDesc_notifications = "<leader>n Notifications"
let g:WhichKeyDesc_usages = "<leader>u Show Usages"
let g:WhichKeyDesc_recent = "<leader>o Recent Locations"
let g:WhichKeyDesc_explorer = "<leader>e Explorer"
let g:WhichKeyDesc_explorer_find = "<leader>E Find in Explorer"

" -----------------------------------------------------------------------------
" Window Management [w]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_windows = "<leader>w Windows"
let g:WhichKeyDesc_windows_split_vertical = "<leader>wv Split Vertical"
let g:WhichKeyDesc_windows_split_horizontal = "<leader>ws Split Horizontal"
let g:WhichKeyDesc_windows_unsplit = "<leader>wu Unsplit"
let g:WhichKeyDesc_windows_maximize = "<leader>wm Maximize"
let g:WhichKeyDesc_windows_save = "<leader>ww Save File"

" -----------------------------------------------------------------------------
" Buffer Management [b]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_buffers = "<leader>b Buffers"
let g:WhichKeyDesc_buffers_next = "<leader>bn Next"
let g:WhichKeyDesc_buffers_previous = "<leader>bp Previous"
let g:WhichKeyDesc_buffers_delete = "<leader>bd Delete"
let g:WhichKeyDesc_buffers_delete_all = "<leader>ba Delete Others"

" -----------------------------------------------------------------------------
" Find & Search [f]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_find = "<leader>f Find"
let g:WhichKeyDesc_find_files = "<leader>ff Files"
let g:WhichKeyDesc_find_grep = "<leader>fg Grep"
let g:WhichKeyDesc_find_buffers = "<leader>fb Buffers"
let g:WhichKeyDesc_find_symbols = "<leader>fs Symbols"
let g:WhichKeyDesc_find_all = "<leader>fa All"

" -----------------------------------------------------------------------------
" Code Actions [c]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_code = "<leader>c Code"
let g:WhichKeyDesc_code_actions = "<leader>ca Actions"
let g:WhichKeyDesc_code_rename = "<leader>cr Rename"
let g:WhichKeyDesc_code_format = "<leader>cf Format"
let g:WhichKeyDesc_code_imports = "<leader>ci Imports"
let g:WhichKeyDesc_code_generate = "<leader>cc Generate"
let g:WhichKeyDesc_code_surround = "<leader>cs Surround With"
let g:WhichKeyDesc_code_error = "<leader>ce Error Description"
let g:WhichKeyDesc_code_hierarchy = "<leader>ch Call Hierarchy"

" -----------------------------------------------------------------------------
" Git Operations [g]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_git = "<leader>g Git"
let g:WhichKeyDesc_git_status = "<leader>gs Status"
let g:WhichKeyDesc_git_blame = "<leader>gb Blame"
let g:WhichKeyDesc_git_history = "<leader>gh History"
let g:WhichKeyDesc_git_diff = "<leader>gd Diff"
let g:WhichKeyDesc_git_branches = "<leader>gB Branches"

" -----------------------------------------------------------------------------
" Refactoring [r]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_refactor = "<leader>r Refactor"
let g:WhichKeyDesc_refactor_menu = "<leader>rr Menu"
let g:WhichKeyDesc_refactor_method = "<leader>rm Extract Method"
let g:WhichKeyDesc_refactor_variable = "<leader>rv Extract Variable"

" -----------------------------------------------------------------------------
" Run & Execute [x]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_execute = "<leader>x Execute"
let g:WhichKeyDesc_execute_run = "<leader>xx Run"
let g:WhichKeyDesc_execute_choose = "<leader>xr Choose Config"
let g:WhichKeyDesc_execute_stop = "<leader>xs Stop"
let g:WhichKeyDesc_execute_test = "<leader>xt Test Class"
let g:WhichKeyDesc_execute_test_method = "<leader>xm Test Method"
let g:WhichKeyDesc_execute_test_failed = "<leader>xf Test Failed"

" -----------------------------------------------------------------------------
" Debug [d]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_debug = "<leader>d Debug"
let g:WhichKeyDesc_debug_debug = "<leader>dd Start Debug"
let g:WhichKeyDesc_debug_breakpoint = "<leader>db Breakpoint"
let g:WhichKeyDesc_debug_stop = "<leader>ds Stop Debug"

" -----------------------------------------------------------------------------
" Bookmarks [k]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_bookmarks = "<leader>k Bookmarks"
let g:WhichKeyDesc_bookmarks_toggle = "<leader>kk Toggle"
let g:WhichKeyDesc_bookmarks_list = "<leader>kl List"
let g:WhichKeyDesc_bookmarks_next = "<leader>kn Next"
let g:WhichKeyDesc_bookmarks_prev = "<leader>kp Previous"

" -----------------------------------------------------------------------------
" Terminal [t]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_terminal = "<leader>t Terminal"
let g:WhichKeyDesc_terminal_open = "<leader>tt Open"
let g:WhichKeyDesc_terminal_new = "<leader>tn New Here"

" -----------------------------------------------------------------------------
" View [v]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_view = "<leader>v View"
let g:WhichKeyDesc_view_database = "<leader>vd Database"
let g:WhichKeyDesc_view_git = "<leader>vg Git"

" -----------------------------------------------------------------------------
" Zen Mode [z]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_zen = "<leader>z Distraction Free"
let g:WhichKeyDesc_zen_full = "<leader>Z Zen Mode"

" -----------------------------------------------------------------------------
" Insert Lines [i]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_insert = "<leader>i Insert"
let g:WhichKeyDesc_insert_below = "<leader>ij Line Below"
let g:WhichKeyDesc_insert_above = "<leader>ik Line Above"

" -----------------------------------------------------------------------------
" Multi-cursor [m]
" -----------------------------------------------------------------------------
let g:WhichKeyDesc_multicursor = "<leader>m Multi-cursor"
let g:WhichKeyDesc_multicursor_all = "<leader>ma Select All"

" =============================================================================
" 5. KEY MAPPINGS
" =============================================================================

" -----------------------------------------------------------------------------
" 5.1 Navigation
" -----------------------------------------------------------------------------

" Window Navigation (Ctrl + hjkl)
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" Window Resizing (Ctrl + Shift + hjkl)
nnoremap <C-S-h> :action StretchSplitToLeft<CR>
nnoremap <C-S-l> :action StretchSplitToRight<CR>
nnoremap <C-S-j> :action StretchSplitToBottom<CR>
nnoremap <C-S-k> :action StretchSplitToTop<CR>

" Window Management
nnoremap <leader>wv :action SplitVertically<CR>
nnoremap <leader>ws :action SplitHorizontally<CR>
nnoremap <leader>wu :action Unsplit<CR>
nnoremap <leader>wm :action HideAllWindows<CR>
nnoremap <leader>ww :w<CR>

" Buffer/Tab Navigation
nnoremap <leader>bn :action NextTab<CR>
nnoremap <leader>bp :action PreviousTab<CR>
nnoremap <leader>bd :action CloseContent<CR>
nnoremap <leader>ba :action CloseAllEditorsButActive<CR>

" Jump History
nnoremap <C-o> :action Back<CR>
nnoremap <C-i> :action Forward<CR>
nnoremap g; :action JumpToLastChange<CR>
nnoremap g, :action JumpToNextChange<CR>
nnoremap <leader>o :action RecentLocations<CR>

" Line Movement (Alt + jk)
nnoremap <A-j> :action MoveLineDown<CR>
nnoremap <A-k> :action MoveLineUp<CR>
vnoremap <A-j> :action MoveLineDown<CR>
vnoremap <A-k> :action MoveLineUp<CR>

" Better Line Navigation
nnoremap H ^
nnoremap L $
vnoremap H ^
vnoremap L $

" -----------------------------------------------------------------------------
" 5.2 File Operations
" -----------------------------------------------------------------------------

" File Search
nnoremap <leader>ff :action GotoFile<CR>
nnoremap <leader>fg :action FindInPath<CR>
nnoremap <leader>fb :action RecentFiles<CR>
nnoremap <leader>fs :action FileStructurePopup<CR>
nnoremap <leader>fa :action SearchEverywhere<CR>

" File Explorer (NERDTree)
let g:NERDTreeMapActivateNode='l'
let g:NERDTreeMapJumpParent='h'
nnoremap <leader>e :NERDTreeToggle<CR>
nnoremap <leader>E :NERDTreeFind<CR>

" -----------------------------------------------------------------------------
" 5.3 Code Navigation
" -----------------------------------------------------------------------------

" Go To
nnoremap gd :action GotoDeclaration<CR>
nnoremap gD :action GotoTypeDeclaration<CR>
nnoremap gi :action GotoImplementation<CR>
nnoremap gr :action FindUsages<CR>
nnoremap <leader>u :action ShowUsages<CR>

" Documentation
nnoremap K :action QuickJavaDoc<CR>
nnoremap <C-k> :action ParameterInfo<CR>
inoremap <C-k> <C-o>:action ParameterInfo<CR>

" Error Navigation
nnoremap ]d :action GotoNextError<CR>
nnoremap [d :action GotoPreviousError<CR>

" Method Navigation
nnoremap ]m :action MethodDown<CR>
nnoremap [m :action MethodUp<CR>

" -----------------------------------------------------------------------------
" 5.4 Code Actions
" -----------------------------------------------------------------------------

" Quick Actions
nnoremap <leader>ca :action ShowIntentionActions<CR>
vnoremap <leader>ca :action ShowIntentionActions<CR>

" Refactoring
nnoremap <leader>cr :action RenameElement<CR>
vnoremap <leader>cr :action RenameElement<CR>
nnoremap <leader>rr :action Refactorings.QuickListPopupAction<CR>
vnoremap <leader>rr :action Refactorings.QuickListPopupAction<CR>
nnoremap <leader>rm :action ExtractMethod<CR>
vnoremap <leader>rm :action ExtractMethod<CR>
nnoremap <leader>rv :action IntroduceVariable<CR>
vnoremap <leader>rv :action IntroduceVariable<CR>

" Formatting
nnoremap <leader>cf :action ReformatCode<CR>
vnoremap <leader>cf :action ReformatCode<CR>
nnoremap <leader>ci :action OptimizeImports<CR>

" Code Generation
nnoremap <leader>cc :action Generate<CR>
nnoremap <leader>cs :action SurroundWith<CR>
vnoremap <leader>cs :action SurroundWith<CR>

" Code Information
nnoremap <leader>ce :action ShowErrorDescription<CR>
nnoremap <leader>ch :action CallHierarchy<CR>

" Comments
nnoremap <leader>/ :action CommentByLineComment<CR>
vnoremap <leader>/ :action CommentByLineComment<CR>

" -----------------------------------------------------------------------------
" 5.5 Git Operations
" -----------------------------------------------------------------------------

nnoremap <leader>gs :action Vcs.Show.Local.Changes<CR>
nnoremap <leader>gb :action Annotate<CR>
nnoremap <leader>gh :action Vcs.ShowTabbedFileHistory<CR>
nnoremap <leader>gd :action Compare.LastVersion<CR>
nnoremap <leader>gB :action Git.Branches<CR>

" -----------------------------------------------------------------------------
" 5.6 Run & Debug
" -----------------------------------------------------------------------------

" Run
nnoremap <leader>xx :action Run<CR>
nnoremap <leader>xr :action ChooseRunConfiguration<CR>
nnoremap <leader>xs :action Stop<CR>

" Test
nnoremap <leader>xt :action RunClass<CR>
nnoremap <leader>xm :action RunCurrentTestMethod<CR>
nnoremap <leader>xf :action RerunFailedTests<CR>

" Debug
nnoremap <leader>dd :action Debug<CR>
nnoremap <leader>db :action ToggleLineBreakpoint<CR>
nnoremap <leader>ds :action Stop<CR>

" -----------------------------------------------------------------------------
" 5.7 Bookmarks
" -----------------------------------------------------------------------------

nnoremap <leader>kk :action ToggleBookmark<CR>
nnoremap <leader>kl :action ShowBookmarks<CR>
nnoremap <leader>kn :action GotoNextBookmark<CR>
nnoremap <leader>kp :action GotoPreviousBookmark<CR>

" -----------------------------------------------------------------------------
" 5.8 Tool Windows
" -----------------------------------------------------------------------------

nnoremap <leader>tt :action ActivateTerminalToolWindow<CR>
nnoremap <leader>tn :action Terminal.OpenInTerminal<CR>
nnoremap <leader>vd :action ActivateDatabaseToolWindow<CR>
nnoremap <leader>vg :action ActivateVersionControlToolWindow<CR>

" =============================================================================
" 6. VISUAL MODE
" =============================================================================

" Better Indenting (stays in visual mode)
vnoremap < <gv
vnoremap > >gv

" Paste without yanking replaced text
vnoremap p "_dP

" Multi-cursor
vnoremap <C-n> :action SelectNextOccurrence<CR>
vnoremap <C-p> :action UnselectPreviousOccurrence<CR>
vnoremap <leader>ma :action SelectAllOccurrences<CR>

" =============================================================================
" 7. UTILITIES
" =============================================================================

" -----------------------------------------------------------------------------
" UI Toggles
" -----------------------------------------------------------------------------
nnoremap <leader>z :action ToggleDistractionFreeMode<CR>
nnoremap <leader>Z :action ToggleZenMode<CR>
nnoremap <leader>n :action CloseAllNotifications<CR>

" -----------------------------------------------------------------------------
" Quick Edits
" -----------------------------------------------------------------------------
nnoremap <leader>w :w<CR>
nnoremap <leader>ij o<Esc>
nnoremap <leader>ik O<Esc>

" -----------------------------------------------------------------------------
" Scrolling (centered)
" -----------------------------------------------------------------------------
nnoremap <C-d> <C-d>zz
nnoremap <C-u> <C-u>zz
nnoremap n nzzzv
nnoremap N Nzzzv

" -----------------------------------------------------------------------------
" Code Folding
" -----------------------------------------------------------------------------
nnoremap zc :action CollapseRegion<CR>
nnoremap zo :action ExpandRegion<CR>
nnoremap za :action ExpandCollapseToggleAction<CR>
nnoremap zM :action CollapseAllRegions<CR>
nnoremap zR :action ExpandAllRegions<CR>

" =============================================================================
" END OF CONFIGURATION
" =============================================================================
" For more information:
" - IdeaVim: https://github.com/JetBrains/ideavim
" - Plugins: https://github.com/JetBrains/ideavim/wiki/IdeaVim-Plugins
" =============================================================================
